<VirtualHost *:80>
    ServerName {{external_hostname}}
    ServerAdmin {{sysadmin_email}}
{% if apache_https["hostname"] != 'none' %}
    # Use a temporary redirect. We want clients to keep checking the original
    # URL to handle the case where we have a different hostname pointing to this
    # server. e.g. portal.biovel.eu -> vers4.at.biovel.eu
    Redirect / https://{{apache_https["hostname"]}}/
</VirtualHost>

<VirtualHost *:443>
    ServerName {{apache_https["hostname"]}}
    ServerAdmin {{sysadmin_email}}

    SSLEngine on
    SSLCertificateFile /etc/apache2/ssl/{{apache_https["hostname"]}}.crt
    SSLCertificateKeyFile /etc/apache2/ssl/{{apache_https["hostname"]}}.key
    SSLCertificateChainFile /etc/apache2/ssl/chain.crt
{% endif %}
  
    # This is the tlite rails app location.
    DocumentRoot {{biovel_portal_install}}/public
    <Directory {{biovel_portal_install}}/public>
        Options -MultiViews
        AllowOverride None
        Order allow,deny
        Allow from all
    </Directory>
    <IfModule expires_module>
        <Directory {{biovel_portal_install}}/public/assets>
            # This directory contains static assets for the Rails application. See
            # http://guides.rubyonrails.org/asset_pipeline.html#far-future-expires-header
            # ETags are not turned off as suggested in this link, as pages that
            # suggest doing this never seem to provide a good reason.
            #
            # Some pages suggest that there exist browsers that ignore Expires
            # when an ETag is present, but they do not name the browsers, and in
            # any case this is merely less efficient, not incorrect behaviour.
            #
            # Other pages suggest that this is a problem when files are delivered
            # by load balanced web servers, which each use a different ETag for the
            # same file, but this is a general ETag problem, unrelated to its
            # combination with Expires. And in any case, it doesn't currently
            # apply to our setup (or to a well-designed load balancing system).
            #
            # On the other hand, keeping the ETag means even the once per day check
            # is efficient, as it typically will not need to download the file.
            # See the comments at
            # http://www.askapache.com/htaccess/apache-speed-etags.html
            #
            ExpiresActive On
            ExpiresDefault "access plus 1 day"
            <FilesMatch "-[0-9a-f]{32}\.">
                # CSS and JS files have a 32-digit hexadecimal hash in the filename.
                # This changes whenever the contents change, allowing us to cache
                # these files for a longer time
                ExpiresDefault "access plus 1 year"
            </FilesMatch>
        </Directory>
    </IfModule>
 
    ErrorLog {{biovel_portal_log}}/error.log
 
    # Possible values include: debug, info, notice, warn, error, crit,
    # alert, emerg.
    LogLevel warn
 
    CustomLog {{biovel_portal_log}}/access.log combined
</VirtualHost>